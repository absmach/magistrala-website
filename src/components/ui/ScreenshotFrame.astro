---
import { Image } from 'astro:assets';

interface Props {
  src: string;
  alt: string;
  class?: string;
}

const { src, alt, class: className = '' } = Astro.props;

// Dynamically resolve all screenshots from src/assets/screenshots
const allImages = import.meta.glob<{ default: ImageMetadata }>(
  '/src/assets/screenshots/*.{png,jpg,jpeg,webp}',
  { eager: true }
);

// Match the config path (e.g. "/screenshots/homepage.png") to the asset
const filename = src.split('/').pop();
const assetPath = `/src/assets/screenshots/${filename}`;
const image = allImages[assetPath]?.default;
---

<div class:list={['screenshot-frame', className]}>
  <div class="screenshot-frame-bar">
    <span class="screenshot-frame-dot"></span>
    <span class="screenshot-frame-dot"></span>
    <span class="screenshot-frame-dot"></span>
  </div>
  {image ? (
    <Image
      src={image}
      alt={alt}
      widths={[640, 960, 1280, 1920]}
      sizes="(max-width: 768px) 100vw, 50vw"
      quality={85}
      loading="lazy"
    />
  ) : (
    <img src={src} alt={alt} loading="lazy" />
  )}
</div>
