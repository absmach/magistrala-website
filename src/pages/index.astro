---
import BaseLayout from '../components/layout/BaseLayout.astro';
import Header from '../components/layout/Header.astro';
import Footer from '../components/layout/Footer.astro';
import Card from '../components/ui/Card.astro';
import AccordionItem from '../components/ui/AccordionItem.astro';
import ScreenshotFrame from '../components/ui/ScreenshotFrame.astro';
import FeatureIcon from '../components/ui/FeatureIcon.astro';
import {
  CTA_BUTTONS,
  PARTNERS,
  FEATURES,
  USE_CASES,
  SUCCESS_STORIES,
  PRICING_PLANS,
  FAQ_ITEMS,
} from '../config/site';
---

<BaseLayout>
  <Header />

  <main>
    <!-- Hero -->
    <section class="relative overflow-hidden text-white min-h-screen flex items-center px-6">
      <video
        autoplay
        muted
        loop
        playsinline
        preload="auto"
        class="absolute inset-0 w-full h-full object-cover"
        poster="/video/hero-poster.jpg"
      >
        <source src="/video/hero-poster.mp4" type="video/mp4" />
      </video>
      <div class="absolute inset-0 bg-black/50 pointer-events-none"></div>
      <div class="relative z-10 max-w-3xl mx-auto text-center">
        <p class="text-sm font-medium tracking-wide uppercase mb-4 text-neutral-300">Open Source IoT Platform</p>
        <h1 class="text-white mb-6">
          Manage your IoT devices from cloud to edge
        </h1>
        <p class="text-lg mb-10 max-w-2xl mx-auto leading-relaxed">
          Magistrala is a secure, scalable platform for device management, real-time messaging, data processing, and visualization. Self-hosted or cloud-managed.
        </p>
        <div class="flex flex-wrap justify-center gap-3">
          <a
            href={CTA_BUTTONS.primary.href}
            target="_blank"
            rel="noopener noreferrer"
            class="px-8 py-3 bg-white text-[#073763] font-medium rounded-lg hover:bg-neutral-100 transition-colors"
          >
            Try Magistrala
          </a>
          <a
            href={CTA_BUTTONS.docs.href}
            target="_blank"
            rel="noopener noreferrer"
            class="px-8 py-3 border border-white/30 text-white font-medium rounded-lg hover:bg-white/10 transition-colors"
          >
            Documentation
          </a>
        </div>
      </div>
    </section>

    <!-- Partners -->
    <section class="py-10 px-4 border-t border-neutral-100 bg-neutral-50 overflow-hidden">
      <p class="text-center text-sm text-neutral-400 uppercase tracking-wide font-medium mb-8">Trusted by teams at</p>
      <div class="marquee-track">
        {[...PARTNERS, ...PARTNERS].map((partner) => (
          <div class="shrink-0 px-8">
            <img
              src={partner.src}
              alt={partner.name}
              style={`height: ${partner.height}px`}
              class="partner-logo w-auto max-w-30 object-contain"
              loading="lazy"
            />
          </div>
        ))}
      </div>
    </section>

    <!-- Features header -->
    <section id="features" class="section-padding bg-white pb-0">
      <div class="max-w-2xl mx-auto text-center reveal">
        <h2 class="mb-4">Everything you need to run IoT at scale</h2>
        <p class="text-neutral-600">
          From device connectivity to dashboards and alarms, Magistrala covers the full IoT stack.
        </p>
      </div>
    </section>

    <!-- Feature bands -->
    {FEATURES.map((feature, i) => (
      <div class:list={['feature-band', i % 2 === 1 ? 'feature-band-tinted' : '']}>
        <div class="max-w-7xl mx-auto">
          <div class:list={['grid lg:grid-cols-2 gap-12 items-center reveal']}>
            <div class:list={[i % 2 === 1 ? 'lg:order-2' : '']}>
              <FeatureIcon icon={feature.icon} class="mb-4" />
              <h3 class="text-2xl font-semibold mb-3 text-[#04203a]">{feature.title}</h3>
              <p class="text-neutral-600 leading-relaxed">{feature.description}</p>
            </div>

            <div class:list={[i % 2 === 1 ? 'lg:order-1' : '']}>
              {feature.visual.type === 'screenshots' && (
                <div class="feature-carousel" data-feature-carousel data-auto="4000">
                  <div class="feature-carousel-track">
                    {feature.visual.images.map((img) => (
                      <div class="feature-carousel-slide">
                        {/* Browser frame */}
                        {(feature.visual as any).frame === 'browser' && (
                          <ScreenshotFrame src={img.src} alt={img.alt} />
                        )}
                        {/* Dashboard frame */}
                        {(feature.visual as any).frame === 'dashboard' && (
                          <div class="dashboard-frame">
                            <div class="dashboard-frame-sidebar">
                              <div class="dashboard-frame-sidebar-dot"></div>
                              <div class="dashboard-frame-sidebar-dot"></div>
                              <div class="dashboard-frame-sidebar-dot active"></div>
                              <div class="dashboard-frame-sidebar-dot"></div>
                              <div class="dashboard-frame-sidebar-dot"></div>
                            </div>
                            <div class="dashboard-frame-content">
                              <img src={img.src} alt={img.alt} loading="lazy" />
                            </div>
                          </div>
                        )}
                        {/* Floating frame */}
                        {(feature.visual as any).frame === 'floating' && (
                          <div class="floating-frame">
                            <img src={img.src} alt={img.alt} loading="lazy" />
                          </div>
                        )}
                      </div>
                    ))}
                  </div>
                  {feature.visual.images.length > 1 && (
                    <div>
                      <div class="flex justify-center gap-2 mt-4">
                        {feature.visual.images.map((_, j) => (
                          <button
                            class:list={['carousel-dot', j === 0 ? 'active' : '']}
                            data-slide={j}
                            aria-label={`Go to slide ${j + 1}`}
                          />
                        ))}
                      </div>
                      <div class="carousel-progress">
                        <div class="carousel-progress-bar"></div>
                      </div>
                    </div>
                  )}
                </div>
              )}

              {feature.visual.type === 'protocols' && (
                <div class="bg-[#f8fafc] rounded-xl border border-neutral-200 p-8">
                  <svg viewBox="0 0 400 280" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-full h-auto">
                    <!-- Central hub -->
                    <circle cx="200" cy="140" r="40" fill="#073763" opacity="0.1" />
                    <circle cx="200" cy="140" r="28" fill="#073763" opacity="0.15" style="animation: pulseRing 3s ease-in-out infinite;" />
                    <circle cx="200" cy="140" r="18" fill="#073763" />
                    <text x="200" y="145" text-anchor="middle" fill="white" font-size="10" font-weight="600">MG</text>

                    <!-- MQTT -->
                    <circle cx="60" cy="60" r="24" fill="#eff6ff" stroke="#073763" stroke-width="1.5" />
                    <text x="60" y="64" text-anchor="middle" fill="#073763" font-size="9" font-weight="600">MQTT</text>
                    <line x1="84" y1="75" x2="175" y2="125" stroke="#073763" stroke-width="1.5" stroke-dasharray="4 4" style="animation: dataFlow 2s linear infinite;" />

                    <!-- CoAP -->
                    <circle cx="340" cy="60" r="24" fill="#eff6ff" stroke="#073763" stroke-width="1.5" />
                    <text x="340" y="64" text-anchor="middle" fill="#073763" font-size="9" font-weight="600">CoAP</text>
                    <line x1="316" y1="75" x2="225" y2="125" stroke="#073763" stroke-width="1.5" stroke-dasharray="4 4" style="animation: dataFlow 2s linear infinite; animation-delay: 0.5s;" />

                    <!-- HTTP -->
                    <circle cx="60" cy="220" r="24" fill="#eff6ff" stroke="#073763" stroke-width="1.5" />
                    <text x="60" y="224" text-anchor="middle" fill="#073763" font-size="9" font-weight="600">HTTP</text>
                    <line x1="84" y1="205" x2="175" y2="155" stroke="#073763" stroke-width="1.5" stroke-dasharray="4 4" style="animation: dataFlow 2s linear infinite; animation-delay: 1s;" />

                    <!-- WebSocket -->
                    <circle cx="340" cy="220" r="24" fill="#eff6ff" stroke="#073763" stroke-width="1.5" />
                    <text x="340" y="218" text-anchor="middle" fill="#073763" font-size="7" font-weight="600">Web</text>
                    <text x="340" y="228" text-anchor="middle" fill="#073763" font-size="7" font-weight="600">Socket</text>
                    <line x1="316" y1="205" x2="225" y2="155" stroke="#073763" stroke-width="1.5" stroke-dasharray="4 4" style="animation: dataFlow 2s linear infinite; animation-delay: 1.5s;" />
                  </svg>
                </div>
              )}

              {feature.visual.type === 'rbac' && (
                <div class="bg-[#f8fafc] rounded-xl border border-neutral-200 p-8">
                  <svg viewBox="0 0 400 260" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-full h-auto">
                    <!-- Domain -->
                    <g style="animation: fadeInScale 0.6s ease forwards;">
                      <rect x="150" y="10" width="100" height="36" rx="8" fill="#073763" />
                      <text x="200" y="33" text-anchor="middle" fill="white" font-size="11" font-weight="600">Domain</text>
                    </g>

                    <!-- Connectors from Domain -->
                    <line x1="175" y1="46" x2="100" y2="80" stroke="#073763" stroke-width="1.5" opacity="0.4" />
                    <line x1="200" y1="46" x2="200" y2="80" stroke="#073763" stroke-width="1.5" opacity="0.4" />
                    <line x1="225" y1="46" x2="300" y2="80" stroke="#073763" stroke-width="1.5" opacity="0.4" />

                    <!-- Admin -->
                    <g style="animation: fadeInScale 0.6s ease forwards; animation-delay: 0.2s;">
                      <rect x="50" y="80" width="100" height="32" rx="6" fill="#eff6ff" stroke="#073763" stroke-width="1.5" />
                      <text x="100" y="100" text-anchor="middle" fill="#073763" font-size="10" font-weight="500">Admin</text>
                    </g>

                    <!-- Editor -->
                    <g style="animation: fadeInScale 0.6s ease forwards; animation-delay: 0.4s;">
                      <rect x="150" y="80" width="100" height="32" rx="6" fill="#eff6ff" stroke="#073763" stroke-width="1.5" />
                      <text x="200" y="100" text-anchor="middle" fill="#073763" font-size="10" font-weight="500">Editor</text>
                    </g>

                    <!-- Viewer -->
                    <g style="animation: fadeInScale 0.6s ease forwards; animation-delay: 0.6s;">
                      <rect x="250" y="80" width="100" height="32" rx="6" fill="#eff6ff" stroke="#073763" stroke-width="1.5" />
                      <text x="300" y="100" text-anchor="middle" fill="#073763" font-size="10" font-weight="500">Viewer</text>
                    </g>

                    <!-- Connectors down -->
                    <line x1="100" y1="112" x2="100" y2="145" stroke="#073763" stroke-width="1" opacity="0.3" />
                    <line x1="200" y1="112" x2="200" y2="145" stroke="#073763" stroke-width="1" opacity="0.3" />
                    <line x1="300" y1="112" x2="300" y2="145" stroke="#073763" stroke-width="1" opacity="0.3" />

                    <!-- Resources row -->
                    <g style="animation: fadeInScale 0.6s ease forwards; animation-delay: 0.8s;">
                      <rect x="40" y="145" width="80" height="28" rx="6" fill="#073763" opacity="0.08" stroke="#073763" stroke-width="1" />
                      <text x="80" y="163" text-anchor="middle" fill="#073763" font-size="9">Clients</text>
                    </g>
                    <g style="animation: fadeInScale 0.6s ease forwards; animation-delay: 0.9s;">
                      <rect x="130" y="145" width="80" height="28" rx="6" fill="#073763" opacity="0.08" stroke="#073763" stroke-width="1" />
                      <text x="170" y="163" text-anchor="middle" fill="#073763" font-size="9">Channels</text>
                    </g>
                    <g style="animation: fadeInScale 0.6s ease forwards; animation-delay: 1s;">
                      <rect x="220" y="145" width="80" height="28" rx="6" fill="#073763" opacity="0.08" stroke="#073763" stroke-width="1" />
                      <text x="260" y="163" text-anchor="middle" fill="#073763" font-size="9">Groups</text>
                    </g>
                    <g style="animation: fadeInScale 0.6s ease forwards; animation-delay: 1.1s;">
                      <rect x="310" y="145" width="80" height="28" rx="6" fill="#073763" opacity="0.08" stroke="#073763" stroke-width="1" />
                      <text x="350" y="163" text-anchor="middle" fill="#073763" font-size="9">Dashboards</text>
                    </g>

                    <!-- Permission badges -->
                    <g style="animation: fadeInScale 0.6s ease forwards; animation-delay: 1.3s;">
                      <rect x="55" y="195" width="50" height="20" rx="10" fill="#073763" opacity="0.12" />
                      <text x="80" y="209" text-anchor="middle" fill="#073763" font-size="8" font-weight="500">read</text>
                      <rect x="115" y="195" width="50" height="20" rx="10" fill="#073763" opacity="0.12" />
                      <text x="140" y="209" text-anchor="middle" fill="#073763" font-size="8" font-weight="500">write</text>
                      <rect x="175" y="195" width="50" height="20" rx="10" fill="#073763" opacity="0.12" />
                      <text x="200" y="209" text-anchor="middle" fill="#073763" font-size="8" font-weight="500">delete</text>
                      <rect x="235" y="195" width="52" height="20" rx="10" fill="#073763" opacity="0.12" />
                      <text x="261" y="209" text-anchor="middle" fill="#073763" font-size="8" font-weight="500">assign</text>
                      <rect x="297" y="195" width="56" height="20" rx="10" fill="#073763" opacity="0.12" />
                      <text x="325" y="209" text-anchor="middle" fill="#073763" font-size="8" font-weight="500">manage</text>
                    </g>

                    <!-- SpiceDB badge -->
                    <g style="animation: fadeInScale 0.6s ease forwards; animation-delay: 1.5s;">
                      <rect x="130" y="232" width="140" height="24" rx="12" fill="#073763" opacity="0.06" stroke="#073763" stroke-width="1" stroke-dasharray="3 3" />
                      <text x="200" y="248" text-anchor="middle" fill="#073763" font-size="8" opacity="0.7">Powered by SpiceDB / Zanzibar</text>
                    </g>
                  </svg>
                </div>
              )}
            </div>
          </div>
        </div>
      </div>
    ))}

    <!-- Why Magistrala -->
    <section class="section-angle-top section-padding bg-neutral-50">
      <div class="max-w-7xl mx-auto">
        <div class="text-center max-w-2xl mx-auto mb-14 reveal">
          <h2 class="mb-4">Why teams choose Magistrala</h2>
        </div>
        <div class="grid md:grid-cols-3 gap-8">
          <div class="text-center reveal">
            <div class="w-12 h-12 mx-auto mb-4 flex items-center justify-center rounded-lg bg-[#eff6ff]">
              <svg class="w-6 h-6 text-[#073763]" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z" />
              </svg>
            </div>
            <h3 class="text-base font-semibold mb-2">Open Source, No Lock-in</h3>
            <p class="text-sm text-neutral-500">Apache 2.0 licensed. Run it on your infrastructure, modify the source, or use our managed cloud. No vendor lock-in.</p>
          </div>
          <div class="text-center reveal">
            <div class="w-12 h-12 mx-auto mb-4 flex items-center justify-center rounded-lg bg-[#eff6ff]">
              <svg class="w-6 h-6 text-[#073763]" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15a4.5 4.5 0 004.5 4.5H18a3.75 3.75 0 001.332-7.257 3 3 0 00-3.758-3.848 5.25 5.25 0 00-10.233 2.33A4.502 4.502 0 002.25 15z" />
              </svg>
            </div>
            <h3 class="text-base font-semibold mb-2">Cloud-Native Architecture</h3>
            <p class="text-sm text-neutral-500">Microservices deployed on Kubernetes. Stateless services scale horizontally. Built for high availability and fault tolerance.</p>
          </div>
          <div class="text-center reveal">
            <div class="w-12 h-12 mx-auto mb-4 flex items-center justify-center rounded-lg bg-[#eff6ff]">
              <svg class="w-6 h-6 text-[#073763]" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125" />
              </svg>
            </div>
            <h3 class="text-base font-semibold mb-2">Pluggable Storage & Brokers</h3>
            <p class="text-sm text-neutral-500">Choose your database (PostgreSQL, TimescaleDB, MongoDB, InfluxDB) and message broker (NATS, Kafka, RabbitMQ).</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Deployments -->
    <section class="section-padding bg-white">
      <div class="max-w-7xl mx-auto">
        <div class="text-center max-w-2xl mx-auto mb-10 reveal">
          <h2 class="mb-4">Global Deployments</h2>
          <p class="text-neutral-600">
            Real-time deployment statistics from Magistrala instances around the world.
          </p>
        </div>
        <div class="deployments-container reveal">
          <div id="deployments-loading" class="deployments-loading">
            <div class="deployments-spinner"></div>
            Loading deployments...
          </div>
          <iframe
            id="deployments-frame"
            title="Magistrala Deployments Dashboard"
            loading="lazy"
          ></iframe>
        </div>
        <div class="text-center mt-6">
          <a
            href="https://deployments.absmach.eu"
            target="_blank"
            rel="noopener noreferrer"
            class="text-sm font-medium text-[#073763] hover:underline"
          >
            View full deployments dashboard &rarr;
          </a>
        </div>
      </div>
    </section>

    <!-- Use Cases -->
    <section id="use-cases" class="section-angle-top section-padding bg-neutral-50">
      <div class="max-w-7xl mx-auto">
        <div class="text-center max-w-2xl mx-auto mb-14 reveal">
          <h2 class="mb-4">Built for your industry</h2>
          <p class="text-neutral-600">
            Magistrala adapts to your domain. From factory floors to smart grids, the platform handles the complexity.
          </p>
        </div>
        <div class="usecase-carousel reveal" data-usecase-carousel>
          <div class="usecase-track">
            {USE_CASES.map((uc) => (
              <div class="usecase-slide px-3">
                <div class="rounded-2xl border border-neutral-200 p-8 bg-white shadow-soft h-full flex flex-col">
                  <FeatureIcon icon={uc.icon} class="mb-4" />
                  <h3 class="text-lg font-semibold mb-2 text-[#04203a]">{uc.title}</h3>
                  <p class="text-sm text-neutral-500 leading-relaxed mb-4 flex-1">{uc.summary}</p>
                  <a
                    href={`/use-cases/${uc.slug}/`}
                    class="text-sm font-medium text-[#073763] hover:underline"
                  >
                    Learn more &rarr;
                  </a>
                </div>
              </div>
            ))}
          </div>
          <div class="flex items-center justify-center gap-4 mt-8">
            <button class="usecase-prev p-2 rounded-full border border-neutral-200 hover:bg-neutral-100 transition-colors" aria-label="Previous use cases">
              <svg class="w-5 h-5 text-neutral-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
              </svg>
            </button>
            <button class="usecase-next p-2 rounded-full border border-neutral-200 hover:bg-neutral-100 transition-colors" aria-label="Next use cases">
              <svg class="w-5 h-5 text-neutral-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
              </svg>
            </button>
          </div>
        </div>
        <div class="text-center mt-6">
          <a
            href="/use-cases/"
            class="text-sm font-medium text-[#073763] hover:underline"
          >
            View all use cases &rarr;
          </a>
        </div>
      </div>
    </section>

    <!-- Success Stories -->
    <section class="section-padding bg-white">
      <div class="max-w-7xl mx-auto">
        <div class="text-center max-w-2xl mx-auto mb-14 reveal">
          <h2 class="mb-4">Deployed in production</h2>
          <p class="text-neutral-600">
            Companies across industries rely on Magistrala for their IoT infrastructure.
          </p>
        </div>
        <div class="grid md:grid-cols-3 gap-8">
          {
            SUCCESS_STORIES.map((story) => (
              <Card>
                <div class="flex items-center justify-center h-16 mb-4">
                  <img
                    src={story.logo}
                    alt={`${story.company} logo`}
                    class="max-h-full max-w-40 w-auto object-contain"
                    loading="lazy"
                  />
                </div>
                <p class="text-sm text-neutral-600 leading-relaxed mb-4">{story.description}</p>
                <a
                  href={story.link}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="text-sm font-medium text-[#073763] hover:underline"
                >
                  {story.linkText} &rarr;
                </a>
              </Card>
            ))
          }
        </div>
      </div>
    </section>

    <!-- Pricing -->
    <section id="pricing" class="section-angle-top section-padding bg-neutral-50">
      <div class="max-w-7xl mx-auto">
        <div class="text-center max-w-2xl mx-auto mb-14 reveal">
          <h2 class="mb-4">Simple pricing</h2>
          <p class="text-neutral-600">
            Start free. Scale when you're ready.
          </p>
        </div>
        <div class="grid md:grid-cols-2 gap-8 max-w-3xl mx-auto">
          {
            PRICING_PLANS.map((plan) => (
              <div class:list={[
                'rounded-xl border p-8 flex flex-col bg-white reveal',
                plan.highlighted ? 'border-[#073763] border-2 relative' : 'border-neutral-200'
              ]}>
                {plan.highlighted && (
                  <span class="absolute -top-3 left-1/2 -translate-x-1/2 bg-[#073763] text-white text-xs font-semibold px-4 py-1 rounded-full">
                    Recommended
                  </span>
                )}
                <h3 class="text-xl font-semibold mb-1 text-[#04203a]">{plan.name}</h3>
                <p class="text-sm mb-6 text-neutral-500">{plan.subtitle}</p>
                <p class="text-3xl font-bold mb-6 text-[#04203a]">{plan.price}</p>
                <ul class="space-y-3 mb-8 flex-1">
                  {plan.features.map((feature) => (
                    <li class="flex items-start gap-2 text-sm">
                      <svg class="w-4 h-4 mt-0.5 shrink-0 text-[#073763]" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                      </svg>
                      <span class="text-neutral-600">{feature}</span>
                    </li>
                  ))}
                </ul>
                <a
                  href={plan.cta.href}
                  target={plan.cta.href.startsWith('http') ? '_blank' : undefined}
                  rel={plan.cta.href.startsWith('http') ? 'noopener noreferrer' : undefined}
                  class="block text-center px-6 py-3 rounded-lg font-medium text-sm transition-colors bg-[#073763] text-white hover:bg-[#0a4a7a]"
                >
                  {plan.cta.label}
                </a>
              </div>
            ))
          }
        </div>
      </div>
    </section>

    <!-- FAQ -->
    <section id="faq" class="section-padding bg-white">
      <div class="max-w-3xl mx-auto">
        <div class="text-center mb-14 reveal">
          <h2 class="mb-4">Frequently asked questions</h2>
        </div>
        {
          FAQ_ITEMS.map((item, i) => (
            <AccordionItem question={item.question} id={`faq-${i}`}>
              {item.answer}
            </AccordionItem>
          ))
        }
      </div>
    </section>

    <!-- CTA -->
    <section class="section-padding bg-[#04203a] text-white text-center relative overflow-hidden">
      <div class="hero-grid"></div>
      <div class="relative z-10 max-w-2xl mx-auto">
        <h2 class="text-white mb-4">Ready to get started?</h2>
        <p class="text-blue-200 mb-8">
          Try Magistrala free on our managed cloud, or deploy the open-source version on your own infrastructure.
        </p>
        <div class="flex flex-wrap justify-center gap-3">
          <a
            href={CTA_BUTTONS.primary.href}
            target="_blank"
            rel="noopener noreferrer"
            class="px-8 py-3 bg-white text-[#073763] font-medium rounded-lg hover:bg-neutral-100 transition-colors"
          >
            Try Magistrala
          </a>
          <a
            href={CTA_BUTTONS.secondary.href}
            class="px-8 py-3 border border-blue-300/30 text-white font-medium rounded-lg hover:bg-white/10 transition-colors"
          >
            Contact Us
          </a>
        </div>
      </div>
    </section>

    <!-- Newsletter -->
    <section class="py-12 px-4 bg-white border-t border-neutral-100">
      <div class="max-w-xl mx-auto text-center">
        <h3 class="mb-2">Stay updated</h3>
        <p class="text-sm text-neutral-500 mb-6">News, updates, and releases from the Magistrala team.</p>
        <form
          action="https://absmach.us11.list-manage.com/subscribe/post?u=70b43c7181d005024187bfb31&amp;id=0a319b6b63&amp;f_id=002711e1f0"
          method="post"
          target="_blank"
          class="flex gap-2 max-w-md mx-auto"
        >
          <input
            type="email"
            name="EMAIL"
            placeholder="you@company.com"
            required
            class="flex-1 px-4 py-2.5 text-sm border border-neutral-200 rounded-lg focus:outline-none focus:border-[#073763] focus:ring-1 focus:ring-[#073763]"
          />
          <div hidden>
            <input type="hidden" name="tags" value="8115258" />
          </div>
          <div style="position: absolute; left: -5000px;" aria-hidden="true">
            <input type="text" name="b_70b43c7181d005024187bfb31_0a319b6b63" tabindex="-1" value="" />
          </div>
          <button
            type="submit"
            class="px-5 py-2.5 bg-[#073763] text-white text-sm font-medium rounded-lg hover:bg-[#0a4a7a] transition-colors shrink-0"
          >
            Subscribe
          </button>
        </form>
        <p class="text-xs text-neutral-400 mt-3">
          By subscribing, you agree to our <a href="/privacy/" class="underline">Privacy Policy</a>. Unsubscribe anytime.
        </p>
      </div>
    </section>
  </main>

  <Footer />

  <!-- Scroll to top -->
  <button id="scroll-top" class="scroll-top-btn" aria-label="Scroll to top">
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 15.75l7.5-7.5 7.5 7.5" />
    </svg>
  </button>
</BaseLayout>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Deployments iframe
    const frame = document.getElementById('deployments-frame') as HTMLIFrameElement;
    const loading = document.getElementById('deployments-loading');
    if (frame && loading) {
      frame.src = 'https://deployments.absmach.eu?filter=hidden&sidebar=hidden';
      frame.onload = () => { loading.style.display = 'none'; };
      setTimeout(() => { loading.style.display = 'none'; }, 10000);
    }

    // Scroll reveal
    const revealEls = document.querySelectorAll('.reveal');
    const revealObserver = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
            revealObserver.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.1 }
    );
    revealEls.forEach((el) => revealObserver.observe(el));

    // Feature carousels (auto-advancing with progress bar)
    document.querySelectorAll('[data-feature-carousel]').forEach((carousel) => {
      const track = carousel.querySelector('.feature-carousel-track') as HTMLElement;
      const dots = carousel.querySelectorAll('.carousel-dot');
      const progressBar = carousel.querySelector('.carousel-progress-bar') as HTMLElement;
      const slideCount = track ? track.children.length : 0;
      if (!track || slideCount <= 1) return;

      let current = 0;
      let autoInterval: ReturnType<typeof setInterval> | null = null;
      let progressStart = 0;
      let progressRaf: number | null = null;
      const delay = parseInt(carousel.getAttribute('data-auto') || '4000');

      function goTo(index: number) {
        current = index;
        track.style.transform = `translateX(-${current * 100}%)`;
        dots.forEach((d) => d.classList.remove('active'));
        dots[current]?.classList.add('active');
        resetProgress();
      }

      function next() {
        goTo((current + 1) % slideCount);
      }

      function resetProgress() {
        progressStart = performance.now();
        if (!progressRaf) tickProgress();
      }

      function tickProgress() {
        if (!progressBar) return;
        const elapsed = performance.now() - progressStart;
        const pct = Math.min((elapsed / delay) * 100, 100);
        progressBar.style.width = `${pct}%`;
        if (pct < 100) {
          progressRaf = requestAnimationFrame(tickProgress);
        } else {
          progressRaf = null;
        }
      }

      function startAuto() {
        stopAuto();
        resetProgress();
        autoInterval = setInterval(next, delay);
      }

      function stopAuto() {
        if (autoInterval) { clearInterval(autoInterval); autoInterval = null; }
        if (progressRaf) { cancelAnimationFrame(progressRaf); progressRaf = null; }
        if (progressBar) progressBar.style.width = '0%';
      }

      // Dot clicks
      dots.forEach((dot) => {
        dot.addEventListener('click', () => {
          goTo(parseInt(dot.getAttribute('data-slide') || '0'));
          startAuto();
        });
      });

      // Pause on hover
      carousel.addEventListener('mouseenter', stopAuto);
      carousel.addEventListener('mouseleave', startAuto);

      // Start
      startAuto();
    });

    // Use case carousel
    const ucCarousel = document.querySelector('[data-usecase-carousel]');
    if (ucCarousel) {
      const track = ucCarousel.querySelector('.usecase-track') as HTMLElement;
      const prevBtn = ucCarousel.querySelector('.usecase-prev');
      const nextBtn = ucCarousel.querySelector('.usecase-next');
      let offset = 0;

      function getVisibleCount() {
        if (window.innerWidth >= 1024) return 3;
        if (window.innerWidth >= 768) return 2;
        return 1;
      }

      function getSlideCount() {
        return track ? track.children.length : 0;
      }

      function update() {
        if (!track) return;
        const pct = 100 / getVisibleCount();
        track.style.transform = `translateX(-${offset * pct}%)`;
      }

      prevBtn?.addEventListener('click', () => {
        offset = Math.max(0, offset - 1);
        update();
      });

      nextBtn?.addEventListener('click', () => {
        const max = getSlideCount() - getVisibleCount();
        offset = Math.min(max, offset + 1);
        update();
      });

      window.addEventListener('resize', () => {
        const max = getSlideCount() - getVisibleCount();
        offset = Math.min(Math.max(0, offset), Math.max(0, max));
        update();
      });
    }

    // Scroll to top
    const scrollBtn = document.getElementById('scroll-top');
    if (scrollBtn) {
      window.addEventListener('scroll', () => {
        scrollBtn.classList.toggle('visible', window.scrollY > 600);
      });
      scrollBtn.addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    }
  });
</script>
