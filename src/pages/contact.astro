---
import BaseLayout from "../components/layout/BaseLayout.astro";
import Header from "../components/layout/Header.astro";
import Footer from "../components/layout/Footer.astro";
import { CONTACT } from "../config/site";
---

<BaseLayout
  title="Contact Us â€” Magistrala IoT Platform"
  description="Get in touch with the Magistrala team. We'd love to hear about your IoT project."
>
  <Header />

  <main class="relative py-20 md:py-28 px-4 bg-neutral-50 overflow-hidden">
    <!-- Decorative paper planes -->
    <svg
      class="pointer-events-none absolute top-16 left-[8%] w-16 h-16 text-[#073763]/[0.06] rotate-[-20deg] hidden lg:block"
      aria-hidden="true"
      fill="currentColor"
      viewBox="0 0 24 24"
    >
      <path d="M2.01 21 23 12 2.01 3 2 10l15 2-15 2z" />
    </svg>
    <svg
      class="pointer-events-none absolute top-40 right-[6%] w-24 h-24 text-[#073763]/[0.05] rotate-[15deg] hidden lg:block"
      aria-hidden="true"
      fill="currentColor"
      viewBox="0 0 24 24"
    >
      <path d="M2.01 21 23 12 2.01 3 2 10l15 2-15 2z" />
    </svg>
    <svg
      class="pointer-events-none absolute bottom-24 left-[5%] w-20 h-20 text-[#073763]/[0.04] rotate-[35deg] hidden lg:block"
      aria-hidden="true"
      fill="currentColor"
      viewBox="0 0 24 24"
    >
      <path d="M2.01 21 23 12 2.01 3 2 10l15 2-15 2z" />
    </svg>
    <!-- Dotted trail decoration -->
    <svg
      class="pointer-events-none absolute top-28 right-[10%] w-40 h-40 text-[#073763]/[0.06] hidden xl:block"
      aria-hidden="true"
      fill="none"
      stroke="currentColor"
      stroke-width="1.5"
      stroke-dasharray="4 6"
      viewBox="0 0 100 100"
    >
      <path d="M10 80 C30 20, 70 20, 90 60" />
    </svg>

    <div class="relative z-10 max-w-3xl mx-auto">
      <!-- Page header -->
      <div class="text-center mb-10">
        <h1 class="text-4xl md:text-5xl font-bold text-[#04203a] mb-3 tracking-tight">
          Contact Us
        </h1>
        <p class="text-neutral-500 text-lg max-w-lg mx-auto">
          Have a question or want to discuss your IoT project? Fill out the form and we'll get back to you shortly.
        </p>
      </div>

      <!-- Form card -->
      <div class="bg-white rounded-2xl shadow-sm border border-neutral-200 p-8 md:p-12">
        <form id="contact-form" class="space-y-6" novalidate>
          <!-- Row: First name / Last name -->
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
            <div>
              <label for="first-name" class="block text-sm font-medium text-neutral-700 mb-1.5">
                First name <span class="text-red-500" aria-hidden="true">*</span>
              </label>
              <input
                type="text"
                id="first-name"
                name="first_name"
                required
                autocomplete="given-name"
                placeholder="Jane"
                class="w-full px-4 py-2.5 rounded-lg border border-neutral-300 text-neutral-800 placeholder-neutral-400 text-sm focus:outline-none focus:ring-2 focus:ring-[#073763]/40 focus:border-[#073763] transition-colors"
              />
            </div>
            <div>
              <label for="last-name" class="block text-sm font-medium text-neutral-700 mb-1.5">
                Last name <span class="text-red-500" aria-hidden="true">*</span>
              </label>
              <input
                type="text"
                id="last-name"
                name="last_name"
                required
                autocomplete="family-name"
                placeholder="Doe"
                class="w-full px-4 py-2.5 rounded-lg border border-neutral-300 text-neutral-800 placeholder-neutral-400 text-sm focus:outline-none focus:ring-2 focus:ring-[#073763]/40 focus:border-[#073763] transition-colors"
              />
            </div>
          </div>

          <!-- Row: Email / Company -->
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
            <div>
              <label for="email" class="block text-sm font-medium text-neutral-700 mb-1.5">
                Email <span class="text-red-500" aria-hidden="true">*</span>
              </label>
              <input
                type="email"
                id="email"
                name="email"
                required
                autocomplete="email"
                placeholder="jane@company.com"
                class="w-full px-4 py-2.5 rounded-lg border border-neutral-300 text-neutral-800 placeholder-neutral-400 text-sm focus:outline-none focus:ring-2 focus:ring-[#073763]/40 focus:border-[#073763] transition-colors"
              />
            </div>
            <div>
              <label for="company" class="block text-sm font-medium text-neutral-700 mb-1.5">
                Company <span class="text-red-500" aria-hidden="true">*</span>
              </label>
              <input
                type="text"
                id="company"
                name="company"
                required
                autocomplete="organization"
                placeholder="Acme Inc."
                class="w-full px-4 py-2.5 rounded-lg border border-neutral-300 text-neutral-800 placeholder-neutral-400 text-sm focus:outline-none focus:ring-2 focus:ring-[#073763]/40 focus:border-[#073763] transition-colors"
              />
            </div>
          </div>

          <!-- Subject -->
          <div>
            <label for="subject" class="block text-sm font-medium text-neutral-700 mb-1.5">
              Subject <span class="text-red-500" aria-hidden="true">*</span>
            </label>
            <input
              type="text"
              id="subject"
              name="subject"
              required
              placeholder="How can we help?"
              class="w-full px-4 py-2.5 rounded-lg border border-neutral-300 text-neutral-800 placeholder-neutral-400 text-sm focus:outline-none focus:ring-2 focus:ring-[#073763]/40 focus:border-[#073763] transition-colors"
            />
          </div>

          <!-- Message -->
          <div>
            <label for="message" class="block text-sm font-medium text-neutral-700 mb-1.5">
              Message <span class="text-red-500" aria-hidden="true">*</span>
            </label>
            <textarea
              id="message"
              name="message"
              required
              rows="5"
              placeholder="Tell us about your project or question..."
              class="w-full px-4 py-2.5 rounded-lg border border-neutral-300 text-neutral-800 placeholder-neutral-400 text-sm focus:outline-none focus:ring-2 focus:ring-[#073763]/40 focus:border-[#073763] transition-colors resize-y"
            ></textarea>
          </div>

          <!-- Submit -->
          <div class="pt-2">
            <button
              type="submit"
              class="group w-full sm:w-auto inline-flex items-center justify-center gap-2 px-8 py-3 bg-[#073763] text-white font-semibold rounded-lg hover:bg-[#0a4a7a] focus:outline-none focus:ring-2 focus:ring-[#073763]/50 focus:ring-offset-2 transition-colors"
            >
              <!-- Paper-plane icon -->
              <svg class="w-4 h-4 transition-transform duration-200 group-hover:translate-x-0.5 group-hover:-translate-y-0.5" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5" />
              </svg>
              Send Message
            </button>
          </div>

         
          <div id="form-success" class="hidden rounded-lg bg-green-50 border border-green-200 p-4 text-sm text-green-800 text-center">
            Thank you! Your message has been sent. We'll get back to you soon.
          </div>

         
          <div id="form-error" class="hidden rounded-lg bg-red-50 border border-red-200 p-4 text-sm text-red-700 text-center">
            Something went wrong. Please try again or email us directly at <a href={`mailto:${CONTACT.email}`} class="underline font-medium">{CONTACT.email}</a>.
          </div>
        </form>
      </div>

     
      <p class="text-center text-sm text-neutral-400 mt-6">
        Prefer email? Reach us at
        <a href={`mailto:${CONTACT.email}`} class="text-[#073763] font-medium hover:underline">{CONTACT.email}</a>
      </p>
    </div>
  </main>

  <Footer />
</BaseLayout>

<script>
  const form = document.getElementById("contact-form") as HTMLFormElement;
  const successEl = document.getElementById("form-success")!;
  const errorEl = document.getElementById("form-error")!;

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    successEl.classList.add("hidden");
    errorEl.classList.add("hidden");

    if (!form.checkValidity()) {
      form.reportValidity();
      return;
    }

    const btn = form.querySelector("button[type=submit]") as HTMLButtonElement;
    const originalHTML = btn.innerHTML;
    btn.disabled = true;
    btn.innerHTML = `<svg class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path></svg> Sending...`;

    try {
      const data = new FormData(form);
      const payload: Record<string, string> = {};
      data.forEach((v, k) => { payload[k] = v as string; });

      const res = await fetch("/api/contact", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });

      if (!res.ok) {
        const err = await res.json().catch(() => ({}));
        throw new Error(err.error || "Request failed");
      }

      successEl.classList.remove("hidden");
      form.reset();
    } catch {
      errorEl.classList.remove("hidden");
    } finally {
      btn.disabled = false;
      btn.innerHTML = originalHTML;
    }
  });
</script>
